version: "3.9"

services:
  signaling:
    build: .
    container_name: webrtc-signaling
    ports:
      - "5001:5001"
    environment:
      LOG_LEVEL: "DEBUG" # INFO/DEBUG/WARNING/ERROR (controla seus logs no app.py)
      LOG_FORMAT: "json" # "text" ou "json"
      ENGINEIO_LOGS: "0" # "1" para verbosidade de transporte/WebSocket
      HOST: "0.0.0.0"
      PORT: "5001"
      WORKERS: "1" # Gunicorn workers (1 é ideal para Eventlet em I/O)
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://127.0.0.1:5001/healthz"]
      interval: 10s
      timeout: 3s
      retries: 5
    restart: unless-stopped

  # -------------------------------------------------------------------
  # (Opcional) TURN server local para testes — habilite se quiser.
  # Em produção, configure TLS, usuários efêmeros e segurança no coturn.
  # -------------------------------------------------------------------
  # turn:
  #   image: coturn/coturn:4.5.2
  #   container_name: coturn
  #   command:
  #     - "-n"                 # sem daemon
  #     - "--log-file=stdout"
  #     - "--listening-port=3478"
  #     - "--realm=local"
  #     - "--lt-cred-mech"
  #     - "--user=user:pass"   # credenciais de teste
  #     - "--no-tls"
  #     - "--no-cli"
  #   ports:
  #     - "3478:3478/udp"
  #     - "3478:3478/tcp"
  #   restart: unless-stopped
